<!DOCTYPE html>
<html lang="en-US">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="http://localhost:1313/images/favicon.png" />
<title>Mastering Asp.Net Core Web Api Security | hoy! i&#39;m crusher</title>
<meta name="title" content="Mastering Asp.Net Core Web Api Security" />
<meta name="description" content="Protecting ASP.NET Core Web Api Security against attacks" />
<meta name="keywords" content="Web API Security,ASP.NET Core,C#,CSRF Protection,XSS Prevention,Rate Limiting,Application Security," />


<meta property="og:url" content="http://localhost:1313/mastering-asp.net-core-web-api-security/">
  <meta property="og:site_name" content="hoy! i&#39;m crusher">
  <meta property="og:title" content="Mastering Asp.Net Core Web Api Security">
  <meta property="og:description" content="Protecting ASP.NET Core Web Api Security against attacks">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2024-06-18T13:03:41+03:00">
    <meta property="article:modified_time" content="2024-06-18T13:03:41+03:00">
    <meta property="article:tag" content="Web API Security">
    <meta property="article:tag" content="ASP.NET Core">
    <meta property="article:tag" content="C#">
    <meta property="article:tag" content="CSRF Protection">
    <meta property="article:tag" content="XSS Prevention">
    <meta property="article:tag" content="Rate Limiting">




  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Mastering Asp.Net Core Web Api Security">
  <meta name="twitter:description" content="Protecting ASP.NET Core Web Api Security against attacks">




  <meta itemprop="name" content="Mastering Asp.Net Core Web Api Security">
  <meta itemprop="description" content="Protecting ASP.NET Core Web Api Security against attacks">
  <meta itemprop="datePublished" content="2024-06-18T13:03:41+03:00">
  <meta itemprop="dateModified" content="2024-06-18T13:03:41+03:00">
  <meta itemprop="wordCount" content="697">
  <meta itemprop="keywords" content="Web API Security,ASP.NET Core,C#,CSRF Protection,XSS Prevention,Rate Limiting,Application Security">
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

  body {
    font-family: "Inter", sans-serif;
    font-optical-sizing: auto;
    font-weight: 500;
    font-style: normal;
    font-variation-settings:
      "slnt" 0;
    margin: auto;
    padding: 20px;
    max-width: 720px;
    text-align: left;
    background-color: #000000;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #ffffff;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #ffffff;
  }

  a {
     
    color: #ff5e6c;
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #000000;
  }

  pre code {
    color: #ffffff;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
    overflow-x: auto;
  }

  div.highlight pre {
    background-color: initial;
    color: initial;
  }

  div.highlight code {
    background-color: unset;
    color: unset;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #ffffff;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: #8b6fcb;
  }
</style>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-92Z130MGQK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-92Z130MGQK');
</script></head>

<body>
  <header><a href="/" class="title">
  <h2>hoy! i&#39;m crusher</h2>
</a>
<nav><a href="/">Home</a>

<a href="/contact/">Contact</a>

<a href="/projects/">Projects</a>

<a href="/favqts/">Quotes</a>


<a href="/blog">Blog</a>

</nav></header>
  <main>

<h1>Mastering Asp.Net Core Web Api Security</h1>
<p>
  <i>
    <time datetime='2024-06-18' pubdate>
      18 Jun, 2024
    </time>
  </i>
</p>

<content>
  <p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/C_Sharp_Logo_2023.svg/1200px-C_Sharp_Logo_2023.svg.png" alt="C# logo"></p>
<h2 id="introduction">Introduction</h2>
<p>In today&rsquo;s interconnected world, securing web APIs is paramount for protecting sensitive data and ensuring the integrity of applications. As developers, understanding and implementing robust security measures such as CSRF (Cross-Site Request Forgery) protection, XSS (Cross-Site Scripting) prevention, and rate limiting can safeguard our APIs from malicious attacks. This blog explores how to master these aspects of web API security using C# ASP.NET Core, empowering you to build resilient and secure applications.</p>
<h2 id="1-cross-site-request-forgery-csrf-protection">1. Cross-Site Request Forgery (CSRF) Protection</h2>
<p>CSRF attacks exploit the trust a web application has in a user&rsquo;s browser by executing unauthorized commands. To defend against CSRF attacks in ASP.NET Core Web API:</p>
<ul>
<li>
<p>Use Anti-CSRF Tokens: Implement Anti-CSRF tokens to validate incoming requests. ASP.NET Core provides middleware to generate and validate these tokens automatically.</p>
</li>
<li>
<p>Require SameSite Cookies: Configure cookies to be SameSite strict to prevent them from being sent by the browser in cross-origin requests, thus mitigating CSRF risk.</p>
</li>
</ul>
<p>Inside our API we create a middleware for validating the CSRF Token:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ConfigureServices(IServiceCollection services)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    services.AddAntiforgery(options =&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        options.HeaderName = <span style="color:#e6db74">&#34;X-CSRF-TOKEN&#34;</span>;
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    app.UseMiddleware&lt;AutoValidateAntiforgeryTokenMiddleware&gt;();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>and in our front-end application we validate the authenticity of every request:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">retrieveCSRFToken</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">axios</span>(<span style="color:#e6db74">&#39;/api/v1/csrf&#39;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">data</span> =&gt; <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">Token</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">error</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Error retrieving csrf token:&#39;</span>, <span style="color:#a6e22e">error</span>));
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">retrieveCSRFToken</span>().<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">token</span> =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">axios</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/api/v1/blogs&#39;</span>, <span style="color:#a6e22e">requestData</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;X-CSRF-Token&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">token</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="2-cross-site-scripting-xss-prevention">2. Cross-Site Scripting (XSS) Prevention</h2>
<p>XSS attacks inject malicious scripts into web pages viewed by other users. To prevent XSS vulnerabilities:</p>
<ul>
<li>
<p>Encode Output: Always encode user input and dynamically generated content before rendering it to prevent script injection.</p>
</li>
<li>
<p>Content Security Policy (CSP): Implement CSP headers to restrict the sources from which content can be loaded, reducing the risk of XSS attacks.</p>
</li>
<li>
<p>Purify and sanitize the user generated content in React to ensure XSS Protection.</p>
</li>
</ul>
<p>In the backend:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    app.Use(<span style="color:#66d9ef">async</span> (context, next) =&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        context.Response.Headers.Add(<span style="color:#e6db74">&#34;Content-Security-Policy&#34;</span>, <span style="color:#e6db74">&#34;default-src &#39;self&#39;&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> next();
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In the frontend:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">DOMPurify</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;dompurify&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">React</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">UnsafeHtmlComponent</span> <span style="color:#f92672">=</span> ({ <span style="color:#a6e22e">htmlContent</span> }) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Sanitize the HTML content using DOMPurify
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sanitizedHtml</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DOMPurify</span>.<span style="color:#a6e22e">sanitize</span>(<span style="color:#a6e22e">htmlContent</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span> <span style="color:#a6e22e">dangerouslySetInnerHTML</span><span style="color:#f92672">=</span>{{ <span style="color:#a6e22e">__html</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">sanitizedHtml</span> }} <span style="color:#f92672">/&gt;</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">UnsafeHtmlComponent</span>;
</span></span></code></pre></div><p>Rendering the component:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">React</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">UnsafeHtmlComponent</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./UnsafeHtmlComponent&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">App</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">htmlContent</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;p&gt;Hello, &lt;b&gt;world&lt;/b&gt;!&lt;/p&gt;&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">h1</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Safely</span> <span style="color:#a6e22e">Rendered</span> <span style="color:#a6e22e">HTML</span> <span style="color:#a6e22e">Content</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/h1&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">UnsafeHtmlComponent</span> <span style="color:#a6e22e">htmlContent</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">htmlContent</span>} <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">App</span>;
</span></span></code></pre></div><p>Additional Considerations</p>
<ul>
<li>
<p>Contextual Escaping: Whenever possible, prefer using React’s built-in methods like dangerouslySetInnerHTML along with DOMPurify for sanitization.</p>
</li>
<li>
<p>Content Sources: Only use dangerouslySetInnerHTML with content that you trust, and always validate and sanitize user-generated content on the server side before rendering it in your React application.</p>
</li>
</ul>
<p>By following these practices, you can effectively sanitize and render HTML content safely in your React applications, protecting against XSS vulnerabilities and ensuring a secure user experience.</p>
<h2 id="3-rate-limiting">3. Rate Limiting</h2>
<p>Implementing rate limiting helps protect your API from abuse by limiting the number of requests a client can make within a specified time frame. This can prevent denial-of-service (DoS) attacks and ensure fair usage of your API:</p>
<ul>
<li>Use Middleware: Implement rate limiting middleware using libraries like AspNetCoreRateLimit to control access rates based on IP address, client ID, or other criteria.</li>
</ul>
<p>Example configuration for rate limiting middleware in <code>Startup.cs</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ConfigureServices(IServiceCollection services)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    services.AddMemoryCache();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    services.Configure&lt;IpRateLimitOptions&gt;(Configuration.GetSection(<span style="color:#e6db74">&#34;IpRateLimiting&#34;</span>));
</span></span><span style="display:flex;"><span>    services.AddSingleton&lt;IIpPolicyStore, MemoryCacheIpPolicyStore&gt;();
</span></span><span style="display:flex;"><span>    services.AddSingleton&lt;IRateLimitCounterStore, MemoryCacheRateLimitCounterStore&gt;();
</span></span><span style="display:flex;"><span>    services.AddSingleton&lt;IRateLimitConfiguration, RateLimitConfiguration&gt;();
</span></span><span style="display:flex;"><span>    services.AddSingleton&lt;IHttpContextAccessor, HttpContextAccessor&gt;();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    app.UseIpRateLimiting();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Example configuration for rate limiting in <code>appsettings.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;IpRateLimiting&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;EnableEndpointRateLimiting&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;StackBlockedRequests&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;RealIpHeader&#34;</span>: <span style="color:#e6db74">&#34;X-Real-IP&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;ClientIdHeader&#34;</span>: <span style="color:#e6db74">&#34;X-ClientId&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;HttpStatusCode&#34;</span>: <span style="color:#ae81ff">429</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;GeneralRules&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Endpoint&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Period&#34;</span>: <span style="color:#e6db74">&#34;1m&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Limit&#34;</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This configuration should limit the incoming requests to 30 request per minute</p>
<h2 id="conclusion">Conclusion</h2>
<p>Mastering web API security against CSRF, XSS, and implementing rate limiting in C# ASP.NET Core involves a combination of understanding the attack vectors, leveraging built-in security features, and implementing best practices. By applying these techniques, you can significantly reduce the risk of security breaches and ensure the reliability and trustworthiness of your applications.</p>
<p>Remember, security is an ongoing process. Stay informed about emerging threats and keep your security measures up to date to protect your APIs and users effectively.</p>

</content>
<p>
  
  <a href="http://localhost:1313/blog/web-api-security/">#Web API Security</a>
  
  <a href="http://localhost:1313/blog/asp.net-core/">#ASP.NET Core</a>
  
  <a href="http://localhost:1313/blog/c/">#C#</a>
  
  <a href="http://localhost:1313/blog/csrf-protection/">#CSRF Protection</a>
  
  <a href="http://localhost:1313/blog/xss-prevention/">#XSS Prevention</a>
  
  <a href="http://localhost:1313/blog/rate-limiting/">#Rate Limiting</a>
  
  <a href="http://localhost:1313/blog/application-security/">#Application Security</a>
  
</p>

  </main>
  <footer>© 2024 CruSheR</footer>

    
</body>

</html>
